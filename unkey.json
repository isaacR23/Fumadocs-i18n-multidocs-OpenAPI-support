{
  "openapi": "3.0.3",
  "info": {
    "title": "Exploration API",
    "description": "API for exploring project analytics, scenarios, alternatives, and tracking data",
    "version": "0.3.1"
  },
  "servers": [
    {
      "url": "https://backend-landing-analytics.fly.dev/api/v0/exploration",
      "description": "Exploration endpoints"
    }
  ],
  "security": [
    {
      "bearerAuth": []
    }
  ],
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    },
    "schemas": {
      "StandardResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "message": {
            "type": "string"
          },
          "content": {
            "oneOf": [
              { "type": "null" },
              { "type": "object" },
              { "type": "array" }
            ]
          }
        },
        "required": ["success", "message", "content"]
      },
      "Flag": {
        "type": "object",
        "properties": {
          "read_name": {
            "type": "string"
          },
          "flag_start": {
            "type": "string",
            "format": "date-time"
          },
          "creation_date": {
            "type": "string",
            "format": "date-time"
          },
          "id_flag": {
            "type": "string"
          }
        },
        "required": ["read_name", "flag_start", "creation_date", "id_flag"]
      },
      "Section": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string"
          },
          "visit_count": {
            "type": "integer"
          },
          "time_spent": {
            "type": "number"
          }
        },
        "required": ["name", "visit_count", "time_spent"]
      },
      "ResponseSection": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string"
          },
          "impressions": {
            "type": "integer"
          },
          "total_time_ms": {
            "type": "number"
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": ["name", "impressions", "total_time_ms", "created_at"]
      },
      "FlagGraphItem": {
        "type": "object",
        "properties": {
          "date": {
            "type": "string",
            "format": "date-time"
          },
          "impressions": {
            "type": "integer"
          },
          "flags": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "date": {
                  "type": "string",
                  "format": "date-time"
                },
                "flag": {
                  "type": "string"
                },
                "id_flag": {
                  "type": "string"
                }
              },
              "required": ["date", "flag", "id_flag"]
            }
          }
        },
        "required": ["date", "impressions", "flags"]
      },
      "DepthGraphItem": {
        "type": "object",
        "properties": {
          "section": {
            "type": "string"
          },
          "id_tracking_data": {
            "type": "string"
          },
          "time_spent_ms": {
            "type": "number"
          },
          "total_visitors": {
            "type": "integer"
          }
        },
        "required": ["section", "id_tracking_data", "time_spent_ms", "total_visitors"]
      },
      "DepthStats": {
        "type": "object",
        "properties": {
          "unique_visitors": {
            "type": "integer"
          },
          "traffic": {
            "type": "integer"
          },
          "most_popular_section": {
            "type": "string"
          },
          "average_time_spent": {
            "type": "number"
          },
          "bounce_rate": {
            "type": "number"
          },
          "visits_1": {
            "type": "integer"
          },
          "visits_2": {
            "type": "integer"
          },
          "visits_3": {
            "type": "integer"
          },
          "visits_4_plus": {
            "type": "integer"
          }
        },
        "required": ["unique_visitors", "traffic", "most_popular_section", "average_time_spent", "bounce_rate", "visits_1", "visits_2", "visits_3", "visits_4_plus"]
      },
      "OverviewStat": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string"
          },
          "value": {
            "type": "number"
          }
        },
        "required": ["name", "value"]
      },
      "DepthOverview": {
        "type": "object",
        "properties": {
          "utm": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/OverviewStat"
            }
          },
          "countries": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/OverviewStat"
            }
          },
          "language": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/OverviewStat"
            }
          },
          "referrer": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/OverviewStat"
            }
          },
          "device_type": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/OverviewStat"
            }
          }
        },
        "required": ["utm", "countries", "language", "referrer", "device_type"]
      },
      "ScenarioAlternative": {
        "type": "object",
        "properties": {
          "id_alternative": {
            "type": "string"
          },
          "alternative_name": {
            "type": "string"
          },
          "sections": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "name": {
                  "type": "string"
                },
                "impressions": {
                  "type": "integer"
                },
                "total_time_ms": {
                  "type": "number"
                }
              },
              "required": ["name", "impressions", "total_time_ms"]
            }
          }
        },
        "required": ["id_alternative", "alternative_name", "sections"]
      },
      "ResponseScenario": {
        "type": "object",
        "properties": {
          "id_scenario": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "description": {
            "type": "string",
            "nullable": true
          },
          "start_at": {
            "type": "string",
            "format": "date-time"
          },
          "finished_at": {
            "type": "string",
            "format": "date-time",
            "nullable": true
          },
          "alternatives": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ScenarioAlternative"
            }
          },
          "favorite": {
            "type": "boolean"
          },
          "winner": {
            "type": "string",
            "nullable": true
          }
        },
        "required": ["id_scenario", "name", "description", "start_at", "finished_at", "alternatives", "favorite", "winner"]
      },
      "ListScenario": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string"
          },
          "id_scenario": {
            "type": "string"
          },
          "start_at": {
            "type": "string",
            "format": "date-time"
          },
          "finished_at": {
            "type": "string",
            "format": "date-time"
          },
          "alternative_a_name": {
            "type": "string"
          },
          "alternative_b_name": {
            "type": "string"
          }
        },
        "required": ["name", "id_scenario", "start_at", "finished_at", "alternative_a_name", "alternative_b_name"]
      },
      "Alternative": {
        "type": "object",
        "properties": {
          "sections": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ResponseSection"
            }
          },
          "status": {
            "type": "string",
            "enum": ["active", "stored"]
          },
          "id_alternative": {
            "type": "string"
          },
          "started_at": {
            "type": "string",
            "format": "date-time"
          },
          "finished_at": {
            "type": "string",
            "format": "date-time",
            "nullable": true
          }
        },
        "required": ["sections", "status", "id_alternative", "started_at", "finished_at"]
      },
      "CurrentScenarioAlternative": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string"
          },
          "visits": {
            "type": "integer"
          },
          "total_time": {
            "type": "number"
          },
          "sections": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "name": {
                  "type": "string"
                },
                "impressions": {
                  "type": "integer"
                },
                "total_time_ms": {
                  "type": "number"
                }
              },
              "required": ["name", "impressions", "total_time_ms"]
            }
          },
          "started_at": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": ["name", "visits", "total_time", "sections", "started_at"]
      },
      "CurrentScenario": {
        "type": "object",
        "properties": {
          "start_at": {
            "type": "string",
            "format": "date-time"
          },
          "finished_at": {
            "type": "string",
            "format": "date-time",
            "nullable": true
          },
          "winner_alternative": {
            "type": "string",
            "nullable": true
          },
          "alternatives": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/CurrentScenarioAlternative"
            }
          }
        },
        "required": ["start_at", "finished_at", "winner_alternative", "alternatives"]
      },
      "FlagRequest": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string"
          },
          "timestamp": {
            "type": "string",
            "format": "date-time"
          },
          "id_flag": {
            "type": "string"
          }
        },
        "required": ["name", "timestamp"]
      },
      "ResetResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "message": {
            "type": "string"
          },
          "content": {
            "type": "object",
            "properties": {
              "new_scenario": {
                "type": "string",
                "nullable": true
              }
            },
            "required": ["new_scenario"]
          }
        },
        "required": ["success", "message", "content"]
      }
    },
    "parameters": {
      "ProjectId": {
        "name": "id_project",
        "in": "path",
        "required": true,
        "description": "The unique identifier for the project",
        "schema": {
          "type": "string"
        }
      },
      "ScenarioId": {
        "name": "id_scenario",
        "in": "path",
        "required": true,
        "description": "The unique identifier for the scenario",
        "schema": {
          "type": "string"
        }
      },
      "AlternativeId": {
        "name": "id_alternative",
        "in": "path",
        "required": true,
        "description": "The unique identifier for the alternative",
        "schema": {
          "type": "string"
        }
      }
    }
  },
  "paths": {
    "/health": {
      "get": {
        "summary": "Health check endpoint",
        "description": "Check if the exploration API is running",
        "operationId": "getHealth",
        "responses": {
          "200": {
            "description": "Service is healthy",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StandardResponse"
                }
              }
            }
          }
        }
      }
    },
    "/flags/{id_project}": {
      "get": {
        "summary": "Get all flags for a project",
        "description": "Retrieve all flags associated with a specific project",
        "operationId": "getFlags",
        "parameters": [
          {
            "$ref": "#/components/parameters/ProjectId"
          }
        ],
        "responses": {
          "200": {
            "description": "Flags retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/StandardResponse"
                    },
                    {
                      "properties": {
                        "content": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/Flag"
                          }
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Invalid request or unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StandardResponse"
                }
              }
            }
          }
        }
      }
    },
    "/sections/{id_project}": {
      "get": {
        "summary": "Get sections for a project",
        "description": "Retrieve all current sections an alternative is tracking for a project",
        "operationId": "getSections",
        "parameters": [
          {
            "$ref": "#/components/parameters/ProjectId"
          }
        ],
        "responses": {
          "200": {
            "description": "Sections retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/StandardResponse"
                    },
                    {
                      "properties": {
                        "content": {
                          "type": "object",
                          "properties": {
                            "sections": {
                              "type": "array",
                              "items": {
                                "$ref": "#/components/schemas/Section"
                              }
                            }
                          }
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Invalid request or unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StandardResponse"
                }
              }
            }
          }
        }
      }
    },
    "/flag/{id_project}": {
      "post": {
        "summary": "Create or update a flag",
        "description": "Create a new flag for the project or update an existing one",
        "operationId": "createOrUpdateFlag",
        "parameters": [
          {
            "$ref": "#/components/parameters/ProjectId"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/FlagRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Flag created or updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/StandardResponse"
                    },
                    {
                      "properties": {
                        "content": {
                          "type": "object",
                          "properties": {
                            "id_flag": {
                              "type": "string"
                            }
                          },
                          "required": ["id_flag"]
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Invalid request or unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StandardResponse"
                }
              }
            }
          }
        }
      }
    },
    "/flag_graph/{id_project}": {
      "get": {
        "summary": "Get flag graph for a project",
        "description": "Retrieve the cumulative flag graph across all alternatives and scenarios with impressions",
        "operationId": "getFlagGraph",
        "parameters": [
          {
            "$ref": "#/components/parameters/ProjectId"
          }
        ],
        "responses": {
          "200": {
            "description": "Flag graph retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/StandardResponse"
                    },
                    {
                      "properties": {
                        "content": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/FlagGraphItem"
                          }
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Invalid request or unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StandardResponse"
                }
              }
            }
          }
        }
      }
    },
    "/depth_graph/{id_project}": {
      "get": {
        "summary": "Get depth graph for a project",
        "description": "Retrieve the graph showing impressions and time spent per section for current tracking alternatives",
        "operationId": "getDepthGraph",
        "parameters": [
          {
            "$ref": "#/components/parameters/ProjectId"
          }
        ],
        "responses": {
          "200": {
            "description": "Depth graph retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/StandardResponse"
                    },
                    {
                      "properties": {
                        "content": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/DepthGraphItem"
                          }
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Invalid request or unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StandardResponse"
                }
              }
            }
          }
        }
      }
    },
    "/depth_stats/{id_project}": {
      "get": {
        "summary": "Get depth statistics for a project",
        "description": "Retrieve comprehensive statistics across all current alternatives including visitors, traffic, popular sections, etc.",
        "operationId": "getDepthStats",
        "parameters": [
          {
            "$ref": "#/components/parameters/ProjectId"
          }
        ],
        "responses": {
          "200": {
            "description": "Depth statistics retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/StandardResponse"
                    },
                    {
                      "properties": {
                        "content": {
                          "$ref": "#/components/schemas/DepthStats"
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Invalid request or unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StandardResponse"
                }
              }
            }
          }
        }
      }
    },
    "/depth_overview/{id_project}": {
      "get": {
        "summary": "Get depth overview for a project",
        "description": "Retrieve overview statistics categorized by UTM, countries, language, referrer, and device type",
        "operationId": "getDepthOverview",
        "parameters": [
          {
            "$ref": "#/components/parameters/ProjectId"
          }
        ],
        "responses": {
          "200": {
            "description": "Depth overview retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/StandardResponse"
                    },
                    {
                      "properties": {
                        "content": {
                          "$ref": "#/components/schemas/DepthOverview"
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Invalid request or unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StandardResponse"
                }
              }
            }
          }
        }
      }
    },
    "/scenario/{id_project}/{id_scenario}": {
      "get": {
        "summary": "Get a specific scenario",
        "description": "Retrieve detailed information about a specific scenario including alternatives and sections",
        "operationId": "getScenario",
        "parameters": [
          {
            "$ref": "#/components/parameters/ProjectId"
          },
          {
            "$ref": "#/components/parameters/ScenarioId"
          }
        ],
        "responses": {
          "200": {
            "description": "Scenario retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/StandardResponse"
                    },
                    {
                      "properties": {
                        "content": {
                          "$ref": "#/components/schemas/ResponseScenario"
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Invalid request or unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StandardResponse"
                }
              }
            }
          },
          "404": {
            "description": "Scenario not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StandardResponse"
                }
              }
            }
          }
        }
      }
    },
    "/scenarios/{id_project}": {
      "get": {
        "summary": "List all scenarios for a project",
        "description": "Retrieve a list of all stored scenarios for a given project",
        "operationId": "getScenarios",
        "parameters": [
          {
            "$ref": "#/components/parameters/ProjectId"
          }
        ],
        "responses": {
          "200": {
            "description": "Scenarios list retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/StandardResponse"
                    },
                    {
                      "properties": {
                        "content": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/ListScenario"
                          }
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Invalid request or unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StandardResponse"
                }
              }
            }
          }
        }
      }
    },
    "/alternative/{id_project}/{id_alternative}": {
      "get": {
        "summary": "Get a specific alternative",
        "description": "Retrieve detailed information about a specific alternative including sections and status",
        "operationId": "getAlternative",
        "parameters": [
          {
            "$ref": "#/components/parameters/ProjectId"
          },
          {
            "$ref": "#/components/parameters/AlternativeId"
          }
        ],
        "responses": {
          "200": {
            "description": "Alternative retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/StandardResponse"
                    },
                    {
                      "properties": {
                        "content": {
                          "$ref": "#/components/schemas/Alternative"
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Invalid request or unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StandardResponse"
                }
              }
            }
          },
          "404": {
            "description": "Alternative not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StandardResponse"
                }
              }
            }
          }
        }
      }
    },
    "/current_scenario/{id_project}": {
      "get": {
        "summary": "Get current scenario for a project",
        "description": "Retrieve the current running scenario constructed from tracking data with calculated winner",
        "operationId": "getCurrentScenario",
        "parameters": [
          {
            "$ref": "#/components/parameters/ProjectId"
          }
        ],
        "responses": {
          "200": {
            "description": "Current scenario retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/StandardResponse"
                    },
                    {
                      "properties": {
                        "content": {
                          "$ref": "#/components/schemas/CurrentScenario"
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Invalid request or unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StandardResponse"
                }
              }
            }
          }
        }
      }
    },
    "/scenario/reset/{id_project}": {
      "get": {
        "summary": "Reset current scenario",
        "description": "Store current alternatives as a scenario and reset all stats, tracking data, and overview information",
        "operationId": "resetScenario",
        "parameters": [
          {
            "$ref": "#/components/parameters/ProjectId"
          }
        ],
        "responses": {
          "200": {
            "description": "Scenario reset successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ResetResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request or unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StandardResponse"
                }
              }
            }
          }
        }
      }
    },
    "/scenario/save/{id_project}": {
      "get": {
        "summary": "Save current scenario",
        "description": "Take a snapshot of the current project state and save as scenario without resetting any information",
        "operationId": "saveScenario",
        "parameters": [
          {
            "$ref": "#/components/parameters/ProjectId"
          }
        ],
        "responses": {
          "200": {
            "description": "Scenario saved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ResetResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request or unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StandardResponse"
                }
              }
            }
          }
        }
      }
    }
  }
}
