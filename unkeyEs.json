{
  "openapi": "3.0.3",
  "info": {
    "title": "API de Exploración",
    "description": "API para explorar analíticas de proyectos, escenarios, alternativas y datos de seguimiento",
    "version": "0.3.1"
  },
  "servers": [
    {
      "url": "https://backend-landing-analytics.fly.dev/api/v0/exploration",
      "description": "Endpoints de exploración"
    }
  ],
  "security": [
    {
      "bearerAuth": []
    }
  ],
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    },
    "schemas": {
      "StandardResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "message": {
            "type": "string"
          },
          "content": {
            "oneOf": [
              { "type": "null" },
              { "type": "object" },
              { "type": "array" }
            ]
          }
        },
        "required": ["success", "message", "content"]
      },
      "Flag": {
        "type": "object",
        "properties": {
          "read_name": {
            "type": "string"
          },
          "flag_start": {
            "type": "string",
            "format": "date-time"
          },
          "creation_date": {
            "type": "string",
            "format": "date-time"
          },
          "id_flag": {
            "type": "string"
          }
        },
        "required": ["read_name", "flag_start", "creation_date", "id_flag"]
      },
      "Section": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string"
          },
          "visit_count": {
            "type": "integer"
          },
          "time_spent": {
            "type": "number"
          }
        },
        "required": ["name", "visit_count", "time_spent"]
      },
      "ResponseSection": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string"
          },
          "impressions": {
            "type": "integer"
          },
          "total_time_ms": {
            "type": "number"
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": ["name", "impressions", "total_time_ms", "created_at"]
      },
      "FlagGraphItem": {
        "type": "object",
        "properties": {
          "date": {
            "type": "string",
            "format": "date-time"
          },
          "impressions": {
            "type": "integer"
          },
          "flags": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "date": {
                  "type": "string",
                  "format": "date-time"
                },
                "flag": {
                  "type": "string"
                },
                "id_flag": {
                  "type": "string"
                }
              },
              "required": ["date", "flag", "id_flag"]
            }
          }
        },
        "required": ["date", "impressions", "flags"]
      },
      "DepthGraphItem": {
        "type": "object",
        "properties": {
          "section": {
            "type": "string"
          },
          "id_tracking_data": {
            "type": "string"
          },
          "time_spent_ms": {
            "type": "number"
          },
          "total_visitors": {
            "type": "integer"
          }
        },
        "required": ["section", "id_tracking_data", "time_spent_ms", "total_visitors"]
      },
      "DepthStats": {
        "type": "object",
        "properties": {
          "unique_visitors": {
            "type": "integer"
          },
          "traffic": {
            "type": "integer"
          },
          "most_popular_section": {
            "type": "string"
          },
          "average_time_spent": {
            "type": "number"
          },
          "bounce_rate": {
            "type": "number"
          },
          "visits_1": {
            "type": "integer"
          },
          "visits_2": {
            "type": "integer"
          },
          "visits_3": {
            "type": "integer"
          },
          "visits_4_plus": {
            "type": "integer"
          }
        },
        "required": ["unique_visitors", "traffic", "most_popular_section", "average_time_spent", "bounce_rate", "visits_1", "visits_2", "visits_3", "visits_4_plus"]
      },
      "OverviewStat": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string"
          },
          "value": {
            "type": "number"
          }
        },
        "required": ["name", "value"]
      },
      "DepthOverview": {
        "type": "object",
        "properties": {
          "utm": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/OverviewStat"
            }
          },
          "countries": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/OverviewStat"
            }
          },
          "language": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/OverviewStat"
            }
          },
          "referrer": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/OverviewStat"
            }
          },
          "device_type": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/OverviewStat"
            }
          }
        },
        "required": ["utm", "countries", "language", "referrer", "device_type"]
      },
      "ScenarioAlternative": {
        "type": "object",
        "properties": {
          "id_alternative": {
            "type": "string"
          },
          "alternative_name": {
            "type": "string"
          },
          "sections": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "name": {
                  "type": "string"
                },
                "impressions": {
                  "type": "integer"
                },
                "total_time_ms": {
                  "type": "number"
                }
              },
              "required": ["name", "impressions", "total_time_ms"]
            }
          }
        },
        "required": ["id_alternative", "alternative_name", "sections"]
      },
      "ResponseScenario": {
        "type": "object",
        "properties": {
          "id_scenario": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "description": {
            "type": "string",
            "nullable": true
          },
          "start_at": {
            "type": "string",
            "format": "date-time"
          },
          "finished_at": {
            "type": "string",
            "format": "date-time",
            "nullable": true
          },
          "alternatives": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ScenarioAlternative"
            }
          },
          "favorite": {
            "type": "boolean"
          },
          "winner": {
            "type": "string",
            "nullable": true
          }
        },
        "required": ["id_scenario", "name", "description", "start_at", "finished_at", "alternatives", "favorite", "winner"]
      },
      "ListScenario": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string"
          },
          "id_scenario": {
            "type": "string"
          },
          "start_at": {
            "type": "string",
            "format": "date-time"
          },
          "finished_at": {
            "type": "string",
            "format": "date-time"
          },
          "alternative_a_name": {
            "type": "string"
          },
          "alternative_b_name": {
            "type": "string"
          }
        },
        "required": ["name", "id_scenario", "start_at", "finished_at", "alternative_a_name", "alternative_b_name"]
      },
      "Alternative": {
        "type": "object",
        "properties": {
          "sections": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ResponseSection"
            }
          },
          "status": {
            "type": "string",
            "enum": ["active", "stored"]
          },
          "id_alternative": {
            "type": "string"
          },
          "started_at": {
            "type": "string",
            "format": "date-time"
          },
          "finished_at": {
            "type": "string",
            "format": "date-time",
            "nullable": true
          }
        },
        "required": ["sections", "status", "id_alternative", "started_at", "finished_at"]
      },
      "CurrentScenarioAlternative": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string"
          },
          "visits": {
            "type": "integer"
          },
          "total_time": {
            "type": "number"
          },
          "sections": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "name": {
                  "type": "string"
                },
                "impressions": {
                  "type": "integer"
                },
                "total_time_ms": {
                  "type": "number"
                }
              },
              "required": ["name", "impressions", "total_time_ms"]
            }
          },
          "started_at": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": ["name", "visits", "total_time", "sections", "started_at"]
      },
      "CurrentScenario": {
        "type": "object",
        "properties": {
          "start_at": {
            "type": "string",
            "format": "date-time"
          },
          "finished_at": {
            "type": "string",
            "format": "date-time",
            "nullable": true
          },
          "winner_alternative": {
            "type": "string",
            "nullable": true
          },
          "alternatives": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/CurrentScenarioAlternative"
            }
          }
        },
        "required": ["start_at", "finished_at", "winner_alternative", "alternatives"]
      },
      "FlagRequest": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string"
          },
          "timestamp": {
            "type": "string",
            "format": "date-time"
          },
          "id_flag": {
            "type": "string"
          }
        },
        "required": ["name", "timestamp"]
      },
      "ResetResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "message": {
            "type": "string"
          },
          "content": {
            "type": "object",
            "properties": {
              "new_scenario": {
                "type": "string",
                "nullable": true
              }
            },
            "required": ["new_scenario"]
          }
        },
        "required": ["success", "message", "content"]
      }
    },
    "parameters": {
      "ProjectId": {
        "name": "id_project",
        "in": "path",
        "required": true,
        "description": "El identificador único del proyecto",
        "schema": {
          "type": "string"
        }
      },
      "ScenarioId": {
        "name": "id_scenario",
        "in": "path",
        "required": true,
        "description": "El identificador único del escenario",
        "schema": {
          "type": "string"
        }
      },
      "AlternativeId": {
        "name": "id_alternative",
        "in": "path",
        "required": true,
        "description": "El identificador único de la alternativa",
        "schema": {
          "type": "string"
        }
      }
    }
  },
  "paths": {
    "/health": {
      "get": {
        "summary": "Endpoint de verificación de salud",
        "description": "Verificar si la API de exploración está funcionando",
        "operationId": "getHealth",
        "responses": {
          "200": {
            "description": "El servicio está funcionando correctamente",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StandardResponse"
                }
              }
            }
          }
        }
      }
    },
    "/flags/{id_project}": {
      "get": {
        "summary": "Obtener todas las banderas de un proyecto",
        "description": "Recuperar todas las banderas asociadas con un proyecto específico",
        "operationId": "getFlags",
        "parameters": [
          {
            "$ref": "#/components/parameters/ProjectId"
          }
        ],
        "responses": {
          "200": {
            "description": "Banderas recuperadas exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/StandardResponse"
                    },
                    {
                      "properties": {
                        "content": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/Flag"
                          }
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Solicitud inválida o no autorizada",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StandardResponse"
                }
              }
            }
          }
        }
      }
    },
    "/sections/{id_project}": {
      "get": {
        "summary": "Obtener secciones de un proyecto",
        "description": "Recuperar todas las secciones actuales que una alternativa está rastreando para un proyecto",
        "operationId": "getSections",
        "parameters": [
          {
            "$ref": "#/components/parameters/ProjectId"
          }
        ],
        "responses": {
          "200": {
            "description": "Secciones recuperadas exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/StandardResponse"
                    },
                    {
                      "properties": {
                        "content": {
                          "type": "object",
                          "properties": {
                            "sections": {
                              "type": "array",
                              "items": {
                                "$ref": "#/components/schemas/Section"
                              }
                            }
                          }
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Solicitud inválida o no autorizada",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StandardResponse"
                }
              }
            }
          }
        }
      }
    },
    "/flag/{id_project}": {
      "post": {
        "summary": "Crear o actualizar una bandera",
        "description": "Crear una nueva bandera para el proyecto o actualizar una existente",
        "operationId": "createOrUpdateFlag",
        "parameters": [
          {
            "$ref": "#/components/parameters/ProjectId"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/FlagRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Bandera creada o actualizada exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/StandardResponse"
                    },
                    {
                      "properties": {
                        "content": {
                          "type": "object",
                          "properties": {
                            "id_flag": {
                              "type": "string"
                            }
                          },
                          "required": ["id_flag"]
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Solicitud inválida o no autorizada",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StandardResponse"
                }
              }
            }
          }
        }
      }
    },
    "/flag_graph/{id_project}": {
      "get": {
        "summary": "Obtener gráfico de banderas de un proyecto",
        "description": "Recuperar el gráfico acumulativo de banderas a través de todas las alternativas y escenarios con impresiones",
        "operationId": "getFlagGraph",
        "parameters": [
          {
            "$ref": "#/components/parameters/ProjectId"
          }
        ],
        "responses": {
          "200": {
            "description": "Gráfico de banderas recuperado exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/StandardResponse"
                    },
                    {
                      "properties": {
                        "content": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/FlagGraphItem"
                          }
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Solicitud inválida o no autorizada",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StandardResponse"
                }
              }
            }
          }
        }
      }
    },
    "/depth_graph/{id_project}": {
      "get": {
        "summary": "Obtener gráfico de profundidad de un proyecto",
        "description": "Recuperar el gráfico que muestra impresiones y tiempo gastado por sección para las alternativas de seguimiento actuales",
        "operationId": "getDepthGraph",
        "parameters": [
          {
            "$ref": "#/components/parameters/ProjectId"
          }
        ],
        "responses": {
          "200": {
            "description": "Gráfico de profundidad recuperado exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/StandardResponse"
                    },
                    {
                      "properties": {
                        "content": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/DepthGraphItem"
                          }
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Solicitud inválida o no autorizada",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StandardResponse"
                }
              }
            }
          }
        }
      }
    },
    "/depth_stats/{id_project}": {
      "get": {
        "summary": "Obtener estadísticas de profundidad de un proyecto",
        "description": "Recuperar estadísticas completas a través de todas las alternativas actuales incluyendo visitantes, tráfico, secciones populares, etc.",
        "operationId": "getDepthStats",
        "parameters": [
          {
            "$ref": "#/components/parameters/ProjectId"
          }
        ],
        "responses": {
          "200": {
            "description": "Estadísticas de profundidad recuperadas exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/StandardResponse"
                    },
                    {
                      "properties": {
                        "content": {
                          "$ref": "#/components/schemas/DepthStats"
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Solicitud inválida o no autorizada",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StandardResponse"
                }
              }
            }
          }
        }
      }
    },
    "/depth_overview/{id_project}": {
      "get": {
        "summary": "Obtener resumen de profundidad de un proyecto",
        "description": "Recuperar estadísticas de resumen categorizadas por UTM, países, idioma, referrer y tipo de dispositivo",
        "operationId": "getDepthOverview",
        "parameters": [
          {
            "$ref": "#/components/parameters/ProjectId"
          }
        ],
        "responses": {
          "200": {
            "description": "Resumen de profundidad recuperado exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/StandardResponse"
                    },
                    {
                      "properties": {
                        "content": {
                          "$ref": "#/components/schemas/DepthOverview"
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Solicitud inválida o no autorizada",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StandardResponse"
                }
              }
            }
          }
        }
      }
    },
    "/scenario/{id_project}/{id_scenario}": {
      "get": {
        "summary": "Obtener un escenario específico",
        "description": "Recuperar información detallada sobre un escenario específico incluyendo alternativas y secciones",
        "operationId": "getScenario",
        "parameters": [
          {
            "$ref": "#/components/parameters/ProjectId"
          },
          {
            "$ref": "#/components/parameters/ScenarioId"
          }
        ],
        "responses": {
          "200": {
            "description": "Escenario recuperado exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/StandardResponse"
                    },
                    {
                      "properties": {
                        "content": {
                          "$ref": "#/components/schemas/ResponseScenario"
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Solicitud inválida o no autorizada",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StandardResponse"
                }
              }
            }
          },
          "404": {
            "description": "Escenario no encontrado",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StandardResponse"
                }
              }
            }
          }
        }
      }
    },
    "/scenarios/{id_project}": {
      "get": {
        "summary": "Listar todos los escenarios de un proyecto",
        "description": "Recuperar una lista de todos los escenarios almacenados para un proyecto dado",
        "operationId": "getScenarios",
        "parameters": [
          {
            "$ref": "#/components/parameters/ProjectId"
          }
        ],
        "responses": {
          "200": {
            "description": "Lista de escenarios recuperada exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/StandardResponse"
                    },
                    {
                      "properties": {
                        "content": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/ListScenario"
                          }
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Solicitud inválida o no autorizada",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StandardResponse"
                }
              }
            }
          }
        }
      }
    },
    "/alternative/{id_project}/{id_alternative}": {
      "get": {
        "summary": "Obtener una alternativa específica",
        "description": "Recuperar información detallada sobre una alternativa específica incluyendo secciones y estado",
        "operationId": "getAlternative",
        "parameters": [
          {
            "$ref": "#/components/parameters/ProjectId"
          },
          {
            "$ref": "#/components/parameters/AlternativeId"
          }
        ],
        "responses": {
          "200": {
            "description": "Alternativa recuperada exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/StandardResponse"
                    },
                    {
                      "properties": {
                        "content": {
                          "$ref": "#/components/schemas/Alternative"
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Solicitud inválida o no autorizada",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StandardResponse"
                }
              }
            }
          },
          "404": {
            "description": "Alternativa no encontrada",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StandardResponse"
                }
              }
            }
          }
        }
      }
    },
    "/current_scenario/{id_project}": {
      "get": {
        "summary": "Obtener escenario actual de un proyecto",
        "description": "Recuperar el escenario actual en ejecución construido a partir de datos de seguimiento con ganador calculado",
        "operationId": "getCurrentScenario",
        "parameters": [
          {
            "$ref": "#/components/parameters/ProjectId"
          }
        ],
        "responses": {
          "200": {
            "description": "Escenario actual recuperado exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/StandardResponse"
                    },
                    {
                      "properties": {
                        "content": {
                          "$ref": "#/components/schemas/CurrentScenario"
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Solicitud inválida o no autorizada",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StandardResponse"
                }
              }
            }
          }
        }
      }
    },
    "/scenario/reset/{id_project}": {
      "get": {
        "summary": "Reiniciar escenario actual",
        "description": "Almacenar alternativas actuales como un escenario y reiniciar todas las estadísticas, datos de seguimiento e información de resumen",
        "operationId": "resetScenario",
        "parameters": [
          {
            "$ref": "#/components/parameters/ProjectId"
          }
        ],
        "responses": {
          "200": {
            "description": "Escenario reiniciado exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ResetResponse"
                }
              }
            }
          },
          "400": {
            "description": "Solicitud inválida o no autorizada",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StandardResponse"
                }
              }
            }
          }
        }
      }
    },
    "/scenario/save/{id_project}": {
      "get": {
        "summary": "Guardar escenario actual",
        "description": "Tomar una instantánea del estado actual del proyecto y guardar como escenario sin reiniciar ninguna información",
        "operationId": "saveScenario",
        "parameters": [
          {
            "$ref": "#/components/parameters/ProjectId"
          }
        ],
        "responses": {
          "200": {
            "description": "Escenario guardado exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ResetResponse"
                }
              }
            }
          },
          "400": {
            "description": "Solicitud inválida o no autorizada",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/StandardResponse"
                }
              }
            }
          }
        }
      }
    }
  }
}
